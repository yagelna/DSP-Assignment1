aws:
  userDataCommands:
    - "#!/bin/bash"
    - "exec >> /tmp/log"
    - "exec 2>&1"
    - "AWS_ACCOUNT_ID=$(aws sts get-caller-identity --query Account --output text)"
    - "AWS_REGION=us-east-1"
    - "MODE=MANAGER"
    - "aws ecr get-login-password --region $AWS_REGION | docker login --username AWS --password-stdin $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com"
    - "docker pull $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/assignments:latest"
    - "docker run -d -e MODE=$MODE $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/assignments:latest"